<div class="space-y-5">
  <!-- Header -->
  <div class="grid grid-cols-1 lg:grid-cols-[1fr_150px] items-start justify-between gap-4">
    <div>
      <h3 class="font-serif text-2xl text-black/75">
        {{ task.title }}
      </h3>
      <p class="mt-2 text-black/60 leading-relaxed">
        {{ task.description }}
      </p>
    </div>
    <div class="flex justify-center">
      <button class="button-primary" (click)="openDialog()">
        Submit
      </button>
    </div>

  </div>

  <!-- Submissions -->
  <details class="group rounded-2xl bg-white/60 ring-1 ring-black/5">
    <summary class="flex cursor-pointer list-none items-center justify-between
             px-5 py-4 text-sm font-medium text-black/65">
      <span>View submissions</span>
      <span class="text-black/45">
        {{ submissions().length }}
      </span>
    </summary>

    <div class="px-5 pb-5 space-y-4">
      @if (!submissions().length) {
      <p class="text-sm text-black/55">
        No submissions yet â€” be the first.
      </p>
      } @else {
      @for (s of submissions(); track s.id) {
      <div class="rounded-xl bg-white/75 ring-1 ring-black/5 p-4">
        <div class="text-sm font-medium text-black/70">
          {{ s.name }}
        </div>

        @if (s.description) {
        <p class="mt-2 text-sm text-black/60">
          {{ s.description }}
        </p>
        }

        @if (s.photoUrl) {
        <img [src]="s.photoUrl" class="mt-3 w-full max-h-[420px] rounded-lg object-cover ring-1 ring-black/5"
          loading="lazy" alt="" />
        }
      </div>
      }
      }
    </div>
  </details>

  <!-- Submit dialog -->
  <dialog #dialog class="rounded-3xl p-0 backdrop:bg-black/40">
    <form method="dialog" class="w-[92vw] max-w-lg">
      <div class="rounded-3xl bg-white p-6 sm:p-8 space-y-4">
        <h2 class="font-serif text-2xl text-black/75">
          Submit: {{ task.title }}
        </h2>

        <label class="block text-sm text-black/55">
          Your name
          <input #nm class="mt-2 w-full rounded-xl bg-white/80 ring-1 ring-black/10 px-4 py-3"
            (input)="name.set(nm.value)" />
        </label>

        <label class="block text-sm text-black/55">
          Description
          <textarea #desc rows="4" class="mt-2 w-full rounded-xl bg-white/80 ring-1 ring-black/10 px-4 py-3"
            (input)="description.set(desc.value)">
          </textarea>
        </label>

        @if (task.type !== 'text') {
        <label class="block text-sm text-black/55">
          Photo @if (task.type === 'photo') { <span class="text-black/45">(required)</span> }
          <input type="file" accept="image/*" class="mt-2 block w-full text-sm" (change)="onFile($event)" />
        </label>
        }

        @if (progress() !== null) {
        <div class="h-2 rounded-full bg-black/10 overflow-hidden">
          <div class="h-2 bg-[#D9A441]" [style.width.%]="progress()"></div>
        </div>
        }

        @if (error()) {
        <p class="text-sm text-red-700/80">
          {{ error() }}
        </p>
        }

        <div class="flex justify-end gap-3 pt-4">
          <button value="cancel" class="rounded-full px-4 py-2 text-sm text-black/60 cursor-pointer">
            Cancel
          </button>
          <button type="button" class="button-primary" (click)="submit()">
            Submit
          </button>
        </div>
      </div>
    </form>
  </dialog>
</div>